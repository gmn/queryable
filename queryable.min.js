!function(t){"use strict";function e(t){var e=typeof t;switch(e){case"object":if(t instanceof Date)return"date";if(t instanceof Array)return"array";if(t instanceof RegExp)return"regexp";default:return e}}function r(){var t="unknown";try{void 0!==exports&&(t="node_module")}catch(e){try{void 0!==window&&(t="browser")}catch(e){}}return t}function n(t,e){for(;t.length&&t.charAt(0)===e;)t=t.substring(e.length,t.length);return t}function i(t){for(var e in t)if(t.hasOwnProperty(e))return e;return null}function a(t){if("object"!=typeof t||t instanceof Array)return t;var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push({key:r,value:t[r]});if(0===e.length)return t;e.sort(function(t,e){return t.key<e.key?-1:1});var n={};return e.forEach(function(t){n[t.key]=t.value}),n}function s(t,e,r){if("object"!=typeof t)return t;var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i);if(0===n.length)return t;var a={};return a[e]=r,n.forEach(function(e){a[e]=t[e]}),a}function o(t){return"array"!==e(t)?t:0===t.length?t:(t.forEach(function(t,e,r){r[e]=a(t)}),t.sort(function(t,e){return i(t)<i(e)?-1:1}),t)}function u(t){if(this.length=0,this.rows=[],1===arguments.length&&"array"===e(t))for(var r=0,n=t.length;n>r;r++)this.push(t[r])}function h(t){function r(){if(this.master.length>0){var t=0,e=!1;if(this.master.forEach(function(r){void 0===r._id?e=!0:r._id>t&&(t=r._id)}),e)for(var r=0,n=this.master.length;n>r;r++)void 0===this.master[r]._id&&(this.master[r]=s(this.master[r],"_id",++t));this._id=t,this.master=this.master.sort(function(t,e){return t._id-e._id})}}if(this.platform=t.platform,this.db_path=t.db_path,this.db_dir=t.db_dir,this.db_name=t.db_name,this.use_gzip=t.use_gzip||!1,this.master=[],this._id=0,t.data)"array"==e(t.data)?this.master=t.data:"string"==e(t.data)?this.master=JSON.parse(t.data):console.log("queryable: error: Could not determine input data type\n"),r.call(this);else if("browser"===this.platform){var n=this.db_name.trim();if(this.db_name=n&&0!==n.length&&"test.db"!==n?n:"queryable",window.localStorage&&localStorage.hasOwnProperty(this.db_name)){var i=localStorage[this.db_name];this.master=JSON.parse(i)}r.call(this)}else if("node_module"===this.platform){var a=require("fs");if(this.db_path.lastIndexOf(".gz")===this.db_path.length-3&&(this.use_gzip=!0),a.existsSync(this.db_path)){var o=!1;if(this.use_gzip)try{var u=require("gzbz"),h=new u.Gunzip;h.init({encoding:"utf8"});var c=a.readFileSync(this.db_path,{encoding:"binary",flag:"r"}),l=h.inflate(c,"binary");return h.end(),this.master=JSON.parse(l),void r.call(this)}catch(f){this.use_gzip=!1,console.log("warning: tried to open as gzip without gzbz module present. Trying normal."),o=!0}try{var d=a.readFileSync(this.db_path,{encoding:"utf8",flag:"r"});this.master=JSON.parse(d),r.call(this)}catch(f){var g='error: "'+this.db_path+'" failed to open.';console.log(g),process.exit(-1)}}}}var c=function(t){console.log(t)};u.prototype={push:function(t){return"object"===e(t)&&this.rows.push(JSON.parse(JSON.stringify(t))),this.length=this.rows.length,this},sort:function(t){var e=i(t),r=t[e];return this.rows.sort(function(t,n){return t[e]?n[e]?"string"==typeof t[e]&&"string"==typeof n[e]?t[e].localeCompare(n[e])*r:t[e]>n[e]?r:-r:r:-r}),this},limit:function(t){var r=Number(t);return"number"!==e(r)?this:(this.rows.splice(r,this.rows.length-r),this.length=this.rows.length,this)},skip:function(t){var r=Number(t);return"number"!==e(r)?this:(this.rows.splice(0,r),this.length=this.rows.length,this)},count:function(){return this.rows.length},getArray:function(){return this.rows},get_json:function(t){return 0===arguments.length?JSON.stringify(this.rows):JSON.stringify(this.rows,null,t)},print:function(t){var e=0===arguments.length?"  ":t;console.log(this.get_json(e))}},h.prototype={save:function(t,r){var n=void 0,i=void 0,a=!1;if(1===arguments.length)if("function"===e(t))i=t;else{var s=Number(t);if("object"==e(t))a=!0;else{if(isNaN(s))throw new Error("save: accepts 0, 1 or 2 arguments, eg.: save(), save(mode), save(mode,callback), or save(callback)");n=s}}else if(2===arguments.length){if("function"!==e(r))throw new Error("save: usage: save(mode, callback)");i=r;var s=Number(t);if(isNaN(s))throw new Error("save: accepts 0, 1 or 2 arguments, eg.: save(), save(mode), save(mode,callback), or save(callback)");n=s}if("node_module"===this.platform){var o=n||438,u=require("fs"),h=!1,c=1;if(this.use_gzip)try{if(h){var l=u.createWriteStream(this.db_path),f=require("zlib"),d=require("stream"),g=new d;g.pipe(f.createGzip()).pipe(l),g.emit("data",JSON.stringify(this.master)),g.emit("end")}else{var _=require("gzbz"),p=new _.Gzip;p.init({encoding:"binary",level:c});var b=p.deflate(JSON.stringify(this.master)),v=p.end(),m=b+v;u.writeFileSync(this.db_path,m,{encoding:"binary",mode:o,flag:"w"})}return this.__return(!0,i)}catch(y){return this.__return(y,i)}try{a?u.writeFileSync(this.db_path,JSON.stringify(this.master,null,2),{encoding:"utf8",mode:o,flag:"w"}):u.writeFileSync(this.db_path,JSON.stringify(this.master),{encoding:"utf8",mode:o,flag:"w"})}catch(y){throw new Error('save: failed writing: "'+this.db_path+'" '+y.toString())}}else"browser"===this.platform&&(a?localStorage[this.db_name]=JSON.stringify(this.master,null,2):localStorage[this.db_name]=JSON.stringify(this.master));return this.__return(!0,i)},insert:function(t,r){function n(t){if("object"!==e(t))throw new Error("insert: row element must be Object");return t._id||(t=s(t,"_id",++i._id)),i.master.push(t),1}if(1!==arguments.length&&2!==arguments.length)throw new Error("insert: accepts 1 or 2 arguments: insert(row [,callback])");var i=this,a=0;if("array"===e(t))for(var o=0,u=t.length;u>o;o++)a+=n(t[o]);else{if("object"!==e(t))throw new Error("insert: accepts Object or Array of Objects");a+=n(t)}return this.__return(a,r)},update:function(t,r,n,i){if(arguments.length<2)throw new Error("usage: update(query,update,[options],[callback])");if("object"!==e(t)||"object"!==e(r))throw new Error("usage: update(query,update,[options],[callback])");if(3===arguments.length&&"object"!==e(n))throw new Error("usage: update(query,update,[options],[callback])");var a=r.$set;if(!a)throw new Error("usage: update(query,update,[options],[callback])");var s=this.do_query(t),o=!1,u=!1;if(n&&(o=n.multi?n.multi:!1,u=n.upsert?n.upsert:!1),0===s.length&&u)return this.insert(a),this.__return(1,i);for(var h=0,c=0,l=s.length;l>c;c++){var f=s[c],d=!1;for(var g in a)if(a.hasOwnProperty(g)){var _=g,p=a[g];f[_]&&f[_]===p||(f[_]=p,d=!0)}if(d&&++h,!o)break}return this.__return(h,i)},find:function(t,r){if(t||(t={}),arguments.length>2||"object"!==e(t))throw new Error("find: usage: find([match],[callback])");var n=this.do_query(t),i=new u(n);return this.__return(i,r)},distinct:function(t,e,r){if(void 0===t)throw new Error("usage: distinct(key,[clause],[callback])");if(e)var n=this.do_query(e);else var n=this.do_query();for(var i=[],a=0,s=n.length;s>a;a++)void 0!==n[a][t]&&i.push(n[a]);for(var o=[],a=0,s=i.length;s>a;a++)o.some(function(e){return e[t]===i[a][t]})||o.push(i[a]);var h=new u(o);return n=null,this.__return(h,r)},remove:function(t,r){if(0===arguments.length)var t={};if("object"!==e(t))throw new Error("usage: remove( [constraints], [callback] )");var n=this.do_query(t);if(0===n.length)return this.__return(0,r);for(var i=[],a=0,s=n.length;s>a;a++){var o=n[a]._id;o&&i.push(o)}if(0===i.length)return this.__return(0,r);var u=0,h=this.master.filter(function(t){for(var e=0,r=i.length;r>e;e++)if(t._id&&t._id===i[e])return++u,!1;return!0});return u>0&&(this.master=h),this.__return(u,r)},get_json:function(){return JSON.stringify(this.master)},print:function(t){var e=0===arguments.length?"  ":t;console.log(JSON.stringify(this.master,null,e))},now:function(){var t=new Date;return t.toISOString&&"function"==typeof t.toISOString?t.toISOString():t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+"T"+t.toUTCString().replace(/.*(\d\d:\d\d:\d\d).*/,"$1")+".000Z"},toDate:function(t){return new Date(t)},count:function(){return this.master.length},renormalize:function(){for(var t=0,e=this.master.length;e>t;t++)this.master[t]=a(this.master[t]);this.master.sort(function(t,e){return t._id-e._id});for(var t=0,e=this.master.length;e>t;t++)this.master[t]._id=1+t},__return:function(t,e){return e?e(t):t},detect_clause_type:function(t,r){switch(e(r)){case"boolean":case"date":case"number":case"string":case"regexp":return-1===t.indexOf(".")?"CLAUSE_NORMAL":"CLAUSE_SUBDOCUMENT_MATCH";case"object":var n=i(r);switch(n){case"$gt":case"$gte":case"$lt":case"$lte":case"$exists":case"$ne":case"$in":return"CLAUSE_CONDITIONAL";default:return"CLAUSE_SUBDOCUMENT"}break;case"array":return"$or"===t?"CLAUSE_OR":"CLAUSE_ARRAY"}return"CLAUSE_UNKNOWN"},matching_rows_NORMAL:function(t,r){var n=[],i=0;t:for(var a=r.length;a>i;i++){var s=r[i];for(var o in s)if(s.hasOwnProperty(o)&&o===t.key)if("regexp"===e(t.value)){var u=s[o]+"";if(u.match(t.value)){n.push(s);continue t}}else if(s[o]===t.value){n.push(s);continue t}}return n},matching_rows_CONDITIONAL:function(t,r){var n=[],a=0,s=i(t.value);t:for(var o=r.length;o>a;a++){var u=r[a];if("$exists"!==s){if("$ne"===s){if(!u[t.key]){n.push(u);continue t}if(u[t.key]!==t.value.$ne){n.push(u);continue t}}for(var h in u)if(u.hasOwnProperty(h)&&h===t.key)switch(s){case"$lt":if(u[h]<t.value[s]){n.push(u);continue t}break;case"$lte":if(u[h]<=t.value[s]){n.push(u);continue t}break;case"$gt":if(u[h]>t.value[s]){n.push(u);continue t}break;case"$gte":if(u[h]>=t.value[s]){n.push(u);continue t}break;case"$ne":if(u[h]!==t.value[s]){n.push(u);continue t}break;case"$in":if("array"===e(t.value[s]))for(var c=t.value[s],l=0;l<c.length;l++)if(u[h]===c[l]){n.push(u);continue t}}}else if(t.value[s]){if(u[t.key]){n.push(u);continue t}}else if(!u[t.key]){n.push(u);continue t}}return s&&delete t.value[s],n},matching_rows_OR:function(t,r){var n=[],a=0;t:for(var s=r.length;s>a;a++)for(var o=r[a],u=0,h=t.length;h>u;u++){var c=i(t[u]),l=t[u][c],f={key:c,value:l},d=this.detect_clause_type(c,l);switch(d){case"CLAUSE_NORMAL":if("regexp"===e(f.value)){if(o[f.key]&&o[f.key].match(f.value)){n.push(o);continue t}}else if(o[f.key]===f.value){n.push(o);continue t}break;case"CLAUSE_CONDITIONAL":switch(i(f.value)){case"$gt":if(o[f.key]>f.value.$gt){n.push(o);continue t}break;case"$gte":if(o[f.key]>=f.value.$gte){n.push(o);continue t}break;case"$lt":if(o[f.key]<f.value.$lt){n.push(o);continue t}break;case"$lte":if(o[f.key]<=f.value.$lte){n.push(o);continue t}break;case"$exists":if(void 0!==o[f.key]&&f.value.$exists){n.push(o);continue t}if(void 0===o[f.key]&&!f.value.$exists){n.push(o);continue t}break;case"$in":if("array"===e(f.value.$in))for(var g=f.value.$in,_=0;_<g.length;_++)if(o[f.key]===g[_]){n.push(o);continue t}}}}return n},do_query:function(t){var r=this.master;if(!t||"object"===e(t)&&null===i(t))return r;for(var n in t)if(t.hasOwnProperty(n)){var a=this.detect_clause_type(n,t[n]);switch(a){case"CLAUSE_NORMAL":r=this.matching_rows_NORMAL({key:n,value:t[n]},r);break;case"CLAUSE_CONDITIONAL":for(;null!==i(t[n]);)r=this.matching_rows_CONDITIONAL({key:n,value:t[n]},r);break;case"CLAUSE_OR":r=this.matching_rows_OR(t[n],r)}}return r},sortMaster:function(){o(this.master)}},t.open=function(i){function a(t){var e=["db_name","db_dir","db_path","use_gzip"];if(arguments.length>0&&"string"==typeof t)try{u.readFileSync(t,{encoding:"utf8",flag:"r"});s.db_path=o.resolve(t),s.db_name=n(s.db_path.substring(s.db_path.lastIndexOf("/"),s.db_path.length),"/"),s.db_dir=s.db_path.substring(0,s.db_path.lastIndexOf(s.db_name))}catch(r){switch(r.code){case"ENOENT":s.db_path=o.resolve(t),s.db_name=n(s.db_path.substring(s.db_path.lastIndexOf("/"),s.db_path.length),"/"),s.db_dir=s.db_path.substring(0,s.db_path.lastIndexOf(s.db_name));break;case"EISDIR":s.db_dir=o.resolve(t)}}else if(arguments.length>0&&"object"==typeof t){for(var i=0;i<e.length;i++)t[e[i]]&&("db_path"===e[i]?t[e[i]]=o.resolve(t[e[i]]):"db_dir"===e[i]?t[e[i]]=o.resolve(t[e[i]]):"db_name"===e[i]&&(t[e[i]]=n(t[e[i]],"/")),s[e[i]]=t[e[i]]);if(t.db_path){var a=n(s.db_path.substring(s.db_path.lastIndexOf("/"),s.db_path.length),"/"),c=s.db_path.substring(0,s.db_path.lastIndexOf(a)),l=0;a!==s.db_name&&(s.db_name=a,++l),c!==s.db_dir&&(s.db_dir=c,++l),l&&(s.db_path=0)}}s.db_path||(s.db_dir&&"/"===s.db_dir[s.db_dir.length-1]?s.db_path=s.db_dir+s.db_name:s.db_path=s.db_dir+"/"+s.db_name);var f=t&&t.data?t.data:void 0;return new h({db_path:s.db_path,db_dir:s.db_dir,db_name:s.db_name,platform:s.platform,use_gzip:s.use_gzip,data:f})}var s=this;switch(this.platform=r(),this.platform){case"node_module":var o=require("path"),u=require("fs");return this.db_name="test.db",this.db_dir=o.resolve(__dirname),this.db_path=0,this.use_gzip=!1,a(i);case"browser":var l="",f=void 0;return"string"===e(i)?l=i:"object"===e(i)&&(l=i&&i.db_name?i.db_name:"",i.string?f=i.string:i.data&&(f=i.data)),new h(f?{platform:"browser",db_name:l,data:f}:{platform:"browser",db_name:l});default:return c("unknown platform"),t}},t.useGzip=function(){arguments.length>0&&(this.use_gzip=arguments[0])};try{window&&(window.queryable=t)}catch(l){}return t}("undefined"==typeof exports?{}:exports);
